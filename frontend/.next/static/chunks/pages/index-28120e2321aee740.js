(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(381)}])},381:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var s=a(5893),n=a(7294),o=a(6485),r=a(1126),l=a(7200),i=a(1376),d=a(2790),u=a(9613),c=a(4715),p=a(2373),m=a(9012),b=a(4489),g=a(4570),h=a(8042);let x=["event ProposalCreated(uint256 proposalId,address proposer,address[] targets,uint256[] values,string[] signatures,bytes[] calldatas,uint256 voteStart,uint256 voteEnd,string description)","function state(uint256 proposalId) view returns (uint8)","function proposalVotes(uint256 proposalId) view returns (uint256 againstVotes, uint256 forVotes, uint256 abstainVotes)","function proposalSnapshot(uint256 proposalId) view returns (uint256)","function proposalDeadline(uint256 proposalId) view returns (uint256)","function proposeWithType(address[] targets, uint256[] values, bytes[] calldatas, string description, uint8 votingType) returns (uint256)","function castVote(uint256 proposalId, uint8 support) returns (uint256)","function castVoteWithReasonAndParams(uint256 proposalId,uint8 support,string reason,bytes params) returns (uint256)"],f=["function store(uint256 newValue)"],v=["function balanceOf(address account) view returns (uint256)","function delegates(address account) view returns (address)","function delegate(address delegatee)"],w=["Pending","Active","Canceled","Defeated","Succeeded","Queued","Expired","Executed"];function N(){let[e,t]=(0,n.useState)(null),[a,N]=(0,n.useState)(null),[j,y]=(0,n.useState)(""),[C,V]=(0,n.useState)([]),[S,k]=(0,n.useState)(""),[I,P]=(0,n.useState)({title:"",value:"0",votingType:"0"}),[E,_]=(0,n.useState)({}),A="0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",F="0x5FbDB2315678afecb367f032d93F642f64180aa3",M="0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0",T=window.ethereum,D=(0,n.useMemo)(()=>e||new o.r6("http://127.0.0.1:8545"),[e]),R=(0,n.useMemo)(()=>D&&A&&A!==r.N?new l.CH(A,x,D):null,[D,A]),W=(0,n.useMemo)(()=>a&&A&&A!==r.N?new l.CH(A,x,a):null,[a,A]),B=(0,n.useMemo)(()=>a&&F&&F!==r.N?new l.CH(F,v,a):null,[a,F]),O=(0,n.useCallback)(async()=>{if(!T){k("No wallet detected. Please install MetaMask.");return}let e=new i.Q(window.ethereum);await e.send("eth_requestAccounts",[]);let a=await e.getSigner();t(e),N(a),y(await a.getAddress()),k("Wallet connected")},[T]),U=(0,n.useCallback)(async()=>{if(R)try{let e=await R.queryFilter(R.filters.ProposalCreated(),0,"latest"),t=await Promise.all(e.map(async e=>{let t=e.args.proposalId,a=(e.args.description||"Untitled").split("\n")[0],s=Number(await R.state(t)),n=await R.proposalVotes(t),o=await R.proposalDeadline(t),r=await D.getBlock("latest"),l=Number(o)-Number(r.number);return{proposalId:t.toString(),title:a,status:w[s]||"Unknown",forVotes:n[1].toString(),againstVotes:n[0].toString(),abstainVotes:n[2].toString(),remainingBlocks:l}}));V(t.reverse())}catch(e){k("Failed to fetch proposals: ".concat(e.shortMessage||e.message))}},[R,D]);async function H(){if(B&&j&&(await B.delegates(j)).toLowerCase()!==j.toLowerCase()){let e=await B.delegate(j);await e.wait()}}async function Q(e){if(e.preventDefault(),!W||!M||M===r.N){k("Missing contract addresses or wallet signer.");return}try{k("Creating proposal..."),await H();let e=new d.vU(f).encodeFunctionData("store",[Number(I.value||0)]),t="".concat(I.title||"Untitled Proposal"),a=await W.proposeWithType([M],[0],[e],t,Number(I.votingType));await a.wait(),k("Proposal created"),await U()}catch(e){k("Proposal failed: ".concat(e.shortMessage||e.message))}}async function q(e,t){if(!W){k("Connect wallet to vote.");return}try{k("Submitting vote..."),await H();let a=E[e],s=a?await W.castVoteWithReasonAndParams(e,t,"vote",u.R.defaultAbiCoder().encode(["uint256"],[Number(a)])):await W.castVote(e,t);await s.wait(),k("Vote submitted"),await U()}catch(e){k("Vote failed: ".concat(e.shortMessage||e.message))}}return(0,n.useEffect)(()=>{U()},[U]),(0,s.jsx)("main",{className:"min-h-screen bg-slate-950 text-slate-100 p-6",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"On-Chain Governance Dashboard"}),(0,s.jsx)("button",{"data-testid":"connect-wallet-button",onClick:O,className:"px-4 py-2 rounded bg-indigo-600 hover:bg-indigo-500",children:j?"Connected":"Connect Wallet"})]}),(0,s.jsx)("div",{"data-testid":"user-address",className:"text-sm text-slate-300 break-all",children:j||"Not connected"}),(0,s.jsxs)("section",{className:"rounded-lg border border-slate-700 p-4 bg-slate-900",children:[(0,s.jsx)("h2",{className:"font-semibold mb-3",children:"Create Proposal"}),(0,s.jsxs)("form",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",onSubmit:Q,children:[(0,s.jsx)("input",{value:I.title,onChange:e=>P(t=>({...t,title:e.target.value})),className:"bg-slate-800 rounded px-3 py-2",placeholder:"Proposal title"}),(0,s.jsx)("input",{type:"number",min:"0",value:I.value,onChange:e=>P(t=>({...t,value:e.target.value})),className:"bg-slate-800 rounded px-3 py-2",placeholder:"Box value"}),(0,s.jsxs)("select",{value:I.votingType,onChange:e=>P(t=>({...t,votingType:e.target.value})),className:"bg-slate-800 rounded px-3 py-2",children:[(0,s.jsx)("option",{value:"0",children:"Standard (1T1V)"}),(0,s.jsx)("option",{value:"1",children:"Quadratic"})]}),(0,s.jsx)("button",{className:"bg-emerald-600 hover:bg-emerald-500 rounded px-3 py-2",children:"Submit"})]})]}),(0,s.jsxs)("section",{className:"rounded-lg border border-slate-700 p-4 bg-slate-900",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h2",{className:"font-semibold",children:"Proposals"}),(0,s.jsx)("button",{onClick:U,className:"px-3 py-1 text-sm rounded bg-slate-700 hover:bg-slate-600",children:"Refresh"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[C.map(e=>{let t=[{name:"For",value:Number(e.forVotes)},{name:"Against",value:Number(e.againstVotes)},{name:"Abstain",value:Number(e.abstainVotes)}];return(0,s.jsxs)("article",{"data-testid":"proposal-list-item",className:"rounded border border-slate-700 p-4",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium",children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-slate-300",children:["Status: ",e.status]}),"Active"===e.status&&(0,s.jsxs)("p",{className:"text-sm text-slate-400",children:["Remaining blocks: ",e.remainingBlocks]})]}),(0,s.jsx)("div",{className:"w-56 h-32",children:(0,s.jsx)(c.h,{width:"100%",height:"100%",children:(0,s.jsxs)(p.u,{children:[(0,s.jsxs)(m.b,{data:t,dataKey:"value",outerRadius:45,children:[(0,s.jsx)(b.b,{fill:"#22c55e"}),(0,s.jsx)(b.b,{fill:"#ef4444"}),(0,s.jsx)(b.b,{fill:"#eab308"})]}),(0,s.jsx)(g.u,{}),(0,s.jsx)(h.D,{})]})})})]}),"Active"===e.status&&(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,s.jsx)("input",{type:"number",min:"1",placeholder:"Optional token spend",className:"bg-slate-800 rounded px-3 py-2 text-sm",value:E[e.proposalId]||"",onChange:t=>_(a=>({...a,[e.proposalId]:t.target.value}))}),(0,s.jsx)("button",{"data-testid":"vote-for-button",onClick:()=>q(e.proposalId,1),className:"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-500",children:"Vote For"}),(0,s.jsx)("button",{"data-testid":"vote-against-button",onClick:()=>q(e.proposalId,0),className:"px-3 py-2 rounded bg-rose-600 hover:bg-rose-500",children:"Vote Against"}),(0,s.jsx)("button",{"data-testid":"vote-abstain-button",onClick:()=>q(e.proposalId,2),className:"px-3 py-2 rounded bg-amber-600 hover:bg-amber-500",children:"Vote Abstain"})]})]},e.proposalId)}),0===C.length&&(0,s.jsx)("p",{className:"text-slate-300",children:"No proposals found."})]})]}),(0,s.jsx)("p",{className:"text-sm text-slate-300",children:S})]})})}}},function(e){e.O(0,[573,888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);